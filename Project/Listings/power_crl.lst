C51 COMPILER V9.60.7.0   POWER_CRL                                                         04/24/2025 16:53:24 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE POWER_CRL
OBJECT MODULE PLACED IN ..\Output\power_crl.obj
COMPILER INVOKED BY: D:\APP\Keil_v5\C51\BIN\C51.EXE ..\BSP\Src\power_crl.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\BSP\
                    -Inc;..\Core\Inc;..\Driver;..\Emembed\Inc;..\SYSTEM\Inc) DEBUG OBJECTEXTEND PRINT(.\Listings\power_crl.lst) OBJECT(..\Out
                    -put\power_crl.obj)

line level    source

   1          #include "power_crl.h"
   2          
   3          AC_DC ac_dc;
   4          GONGLV gonglv;
   5          
   6          /**
   7           * @brief       ç§»ç›¸è§¦å‘è°ƒç”¨ç»“æž„ä½“åˆå§‹åŒ–
   8           *
   9           * @param   
  10           *
  11           * @return  void
  12          **/
  13          void Power_Statu_Init( void )
  14          {
  15   1          ac_dc.zero_flag  = 0;
  16   1          ac_dc.ac220_flag = 0;
  17   1          temp.temp_scan_flag = 0;
  18   1          AC_Out1 = AC_Out2 = AC_Out3 = 1;
  19   1      }
  20          
  21          /**
  22           * @brief       åŠŸçŽ‡è®¡æ—¶åˆå§‹åŒ–
  23           *
  24           * @param   
  25           *
  26           * @return  void
  27          **/
  28          void power_time_Init( void )
  29          {
  30   1          gonglv.gonglv_cnt = 0;
  31   1          gonglv.gonglv_min = 0;
  32   1          gonglv.gonglv_h = 0;
  33   1          gonglv.gonglv_memory_flag = 0;
  34   1      }
  35          
  36          /**
  37           * @brief       å¤–éƒ¨ä¸­æ–­0ä¸­æ–­å¤„ç†å‡½æ•°
  38           *
  39           * @param   
  40           *
  41           * @return  void
  42          **/
  43          void INT0_ISR( void ) interrupt 0
  44          {
  45   1          /* 1, æ£€æµ‹åˆ°å¤–éƒ¨ä¸­æ–­åŽï¼Œç­‰å¾…THL\TLIåŽè§¦å‘TIM1ä¸­æ–­       */
  46   1          TL1 = ac_dc.time_delay;                             
  47   1              TH1 = ac_dc.time_delay >> 8;                            
  48   1      
  49   1          ac_dc.zero_flag = 1;
  50   1          ac_dc.ac220_flag = 1;
  51   1      
  52   1          /* 2, å®šæ—¶å™¨1å¼€å§‹è®¡æ—¶ï¼Œæ‰“å¼€TIM1ä¸­æ–­                     */
  53   1          TR1 = 1;                                 
C51 COMPILER V9.60.7.0   POWER_CRL                                                         04/24/2025 16:53:24 PAGE 2   

  54   1          ET1 = 1; 
  55   1      }
  56          
  57          /**
  58           * @brief       Timer1ä¸­æ–­å¤„ç†å‡½æ•°
  59           *
  60           * @param   
  61           *
  62           * @return  void
  63          **/
  64          void Tim1_ISR( void ) interrupt 3   //10ms
  65          {
  66   1          /* 1, ä¸­æ–­è§¦å‘åŽï¼Œpower_chç”µå¹³ ç”±é«˜ç”µå¹³å˜ä¸ºä½Žç”µå¹³           */
  67   1          if( ac_dc.zero_flag == 1 )
  68   1          {
  69   2              ac_dc.zero_flag = 0;
  70   2      
  71   2               /* 2, æ¸©åº¦å…è®¸ï¼Œä½¿èƒ½ä¸º1æ—¶å¯å¼€å¯è¾“å‡º          */
  72   2              if(( ac_dc.ac220_out1_enable == 1 ) && (ac_dc.ac220_out1_temp_allow == 1))
  73   2              {
  74   3                  AC_Out1 = 0;
  75   3              }
  76   2              if(( ac_dc.ac220_out2_enable == 1 ) && (ac_dc.ac220_out2_temp_allow == 1))
  77   2              {
  78   3                  AC_Out2 = 0;
  79   3              }
  80   2              if(( ac_dc.ac220_out3_enable == 1 ) && (ac_dc.ac220_out3_temp_allow == 1))
  81   2              {
  82   3                  AC_Out3 = 0;
  83   3              }
  84   2      
  85   2               /* 3, è®¾ç½®ä¸‹ä¸€æ¬¡Timer1ä¸­æ–­è§¦å‘æ‰€éœ€æ—¶é—´ï¼Œå³è„‰å†²æ—¶é—´       */
  86   2              TL1 = 0xF7;                             
  87   2              TH1 = 0xFF;                             
  88   2          }else
  89   1          {
  90   2              /* 2, ä¸‹ä¸€æ¬¡è¿›å…¥Timer1ä¸­æ–­ï¼Œpower_chç”µå¹³ ç”±ä½Žç”µå¹³å˜ä¸ºé«˜ç”µå¹³ï¼Œå®Œæˆä¸€æ¬¡10usè
             -„‰å†²ï¼Œå³æ–©æ³¢*/
  91   2              AC_Out1 = AC_Out2 = AC_Out3 = 1;
  92   2      
  93   2              /* 3, å®šæ—¶å™¨1åœæ­¢è®¡æ—¶ï¼Œå…³é—­TIM1ä¸­æ–­ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡å¤–éƒ¨ä¸­æ–­     */
  94   2              TR1 = 0;                                    
  95   2              ET1 = 0; 
  96   2          }
  97   1      }
  98          
  99          /**
 100           * @brief       220Vè¾“å‡ºåŠŸçŽ‡æŽ§åˆ¶å‡½æ•° 
 101           *
 102           * @param   power_levelï¼šè¾“å‡ºåŠŸçŽ‡ç™¾åˆ†æ¯”  0%~100%
 103           *
 104           * @return  void
 105          **/
 106          void ac_220v_crl( uint8_t power_level )
 107          {
 108   1          ac_dc.time_delay = 56500 + 90*power_level;
 109   1      }
 110          
 111          /**
 112           * @brief       24V LEDå¼€å…³æŽ§åˆ¶å‡½æ•°
 113           *
 114           * @param   on_offï¼š0ï¼šå…³é—­ 1ï¼šå¼€å¯
C51 COMPILER V9.60.7.0   POWER_CRL                                                         04/24/2025 16:53:24 PAGE 3   

 115           *
 116           * @return  void
 117          **/
 118          void led_ctrl( uint8_t on_off )
 119          {
 120   1          if( on_off == FAN_ON )
 121   1          {
 122   2              LED = 0;
 123   2          }else
 124   1          {
 125   2              LED = 1;
 126   2          }
 127   1      }
 128          
 129          /**
 130           * @brief       24V PWMé£Žæ‰‡æ¡£ä½æŽ§åˆ¶å‡½æ•°
 131           *
 132           * @param   level :é£Žæ‰‡æ¡£ä½ 0~6æ¡£
 133           *
 134           * @return  void
 135          **/
 136          void fan_ctrl( uint8_t level )
 137          {
 138   1          PWMB_CCR7= level * 184;
 139   1      }
 140          
 141          /**
 142           * @brief       åŒæ­¥æŽ§åˆ¶å‡½æ•°ï¼šæ— å¤–éƒ¨ä¿¡å·æ—¶ PWMé£Žæ‰‡å’Œ220Vè¾“å‡ºå…³é—­
 143           *
 144           * @param   
 145           *
 146           * @return  void
 147          **/
 148          void    sync_ctrl( void )
 149          {
 150   1          if( ac_dc.sync_flag == 1 )
 151   1          {
 152   2              if( ac_dc.signal_in_flag == 1 )
 153   2              {
 154   3                  PWMB_BKR = 0x80;    //PWMæŽ§åˆ¶
 155   3                  EX0 = 1;            //å¤–éƒ¨ä¸­æ–­æŽ§åˆ¶
 156   3              }else
 157   2              {
 158   3                  PWMB_BKR = 0x00; 
 159   3                  EX0 = 0;
 160   3              }
 161   2          }else
 162   1          {
 163   2              PWMB_BKR = 0x80; 
 164   2              EX0 = 1;
 165   2          }
 166   1      }
 167          
 168          /**
 169           * @brief       æ¨¡å¼æŽ§åˆ¶å‡½æ•° 
 170           *
 171           * @param   
 172           *
 173           * @return  void
 174          **/
 175          void mode_ctrl( uint8_t mode_num )
 176          {
C51 COMPILER V9.60.7.0   POWER_CRL                                                         04/24/2025 16:53:24 PAGE 4   

 177   1          switch (mode_num)
 178   1          {
 179   2              case 1:
 180   2                  ac_220v_crl(30);
 181   2                  fan_ctrl(3);
 182   2      
 183   2                  eeprom.ac220_level = 30;
 184   2                  eeprom.pwm_info = 3;
 185   2                  eeprom_data_record();
 186   2      
 187   2                  break;
 188   2      
 189   2              case 2:
 190   2                  ac_220v_crl(50);
 191   2                  fan_ctrl(4);
 192   2      
 193   2                  eeprom.ac220_level = 50;
 194   2                  eeprom.pwm_info = 4;
 195   2                  eeprom_data_record();
 196   2      
 197   2                  break;
 198   2      
 199   2              case 3:
 200   2                  ac_220v_crl(80);
 201   2                  fan_ctrl(6);
 202   2      
 203   2                  eeprom.ac220_level = 80;
 204   2                  eeprom.pwm_info = 6;
 205   2                  eeprom_data_record();
 206   2      
 207   2                  break;
 208   2      
 209   2              default:
 210   2                  break;
 211   2          }
 212   1      }
 213          
 214          /**
 215           * @brief æ¸©åº¦æ‰«æï¼Œ1s/æ¬¡ æŽ§åˆ¶220Vè¾“å‡ºä½¿èƒ½
 216           *
 217           * @param[in] 
 218           * 
 219           * @return  
 220           * 
 221          **/
 222          void temp_scan( void )
 223          {
 224   1          if( temp.temp_scan_flag == 1)
 225   1          {
 226   2              temp.temp_value1 =  get_temp(NTC_1);
 227   2              // temp.temp_value2 =  get_temp(NTC_2);
 228   2              // temp.temp_value3 =  get_temp(NTC_3);
 229   2              Read_DHT11();
 230   2      
 231   2              if( temp.temp_value1 >= temp.temp_alarm_value )  
 232   2              {
 233   3                  ac_dc.ac220_out1_temp_allow = 0;     
 234   3                  ac_dc.ac220_out2_temp_allow = 0;
 235   3                  ac_dc.ac220_out3_temp_allow = 0;  
 236   3      
 237   3              }else
 238   2              {
C51 COMPILER V9.60.7.0   POWER_CRL                                                         04/24/2025 16:53:24 PAGE 5   

 239   3                  ac_dc.ac220_out1_temp_allow = 1;     
 240   3                  ac_dc.ac220_out2_temp_allow = 1;
 241   3                  ac_dc.ac220_out3_temp_allow = 1; 
 242   3              }
 243   2      
 244   2              temp.temp_scan_flag = 0;
 245   2          }
 246   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    397    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     19    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
